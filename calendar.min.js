let icalTemplate="https://api.twitch.tv/helix/schedule/icalendar?broadcaster_id={id}";const calendarInstance=new calendarJs("calendar");async function loadFeed(broadcaster_id,color){let req=await fetch(icalTemplate.replace("{id}",broadcaster_id));if(req.status!=200){return}let icalText=await req.text();let icalParsed=ICAL.parse(icalText);let compData=new ICAL.Component(icalParsed);let name=compData.getFirstPropertyValue("name");let vevents=compData.getAllSubcomponents("vevent");const events=[];vevents.forEach(vevent=>{const event=new ICAL.Event(vevent);let duration=event.endDate.toJSDate()-event.startDate.toJSDate();if(event.summary==""){event.summary="A Stream"}let expand=new ICAL.RecurExpansion({component:vevent,dtstart:vevent.getFirstPropertyValue("dtstart")});let next;let counter=0;while(counter<52&&(next=expand.next())){counter++;let end=next.toJSDate();end.setMilliseconds(end.getMilliseconds()+duration);events.push({title:event.summary,from:next.toJSDate(),to:end,color:color,url:`https://twitch.tv/${name.toLowerCase()}`,locked:true})}});calendarInstance.addEvents(events)}let params=new URLSearchParams(window.location.search);let broadcaster_id=params.get("user_id");let color=`#${params.get("color")??"924afe"}`;if(broadcaster_id){loadFeed(broadcaster_id,color)}
